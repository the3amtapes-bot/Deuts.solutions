<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <title>DB Payment Tracker</title>
  <link rel="icon" href="https://corporates.db.com/static/payment-tracker/favicon.ico" />
  <link rel="apple-touch-icon" href="https://corporates.db.com/static/payment-tracker/logo192.png" />
  <link rel="stylesheet" href="./main.1.css" />

  <style>
    .blurred {
      filter: blur(4px);
      pointer-events: none;
      user-select: none;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 12px;
      border: 3px solid #e0e0e0;
      border-top: 3px solid #0072ce;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #loading-popup {
      display: none;
      position: absolute;
      min-width: 320px;
      min-height: 48px;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #f8fafc;
      color: #1a2a3a;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 500;
      box-shadow: 0 8px 32px rgba(0, 114, 206, 0.08);
      border: 1px solid #d1e3f8;
      z-index: 9999;
      white-space: nowrap;
      transform: translateX(-50%);
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
    }

    #loading-popup.active {
      display: flex;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>

  <!-- App content -->
  <div id="pt-app">
    <div class="search-page">
      <div class="search-form-wrapper">
        <h3>Payment Status Search</h3>
        <h4>Please enter your UETR or alternatively your payment details</h4>
        <h6>All fields are mandatory</h6>

        <div class="tabs">
          <div class="button-wrap">
            <button class="medium blue" disabled>UETR</button>
          </div>
          <div class="button-wrap">
            <button class="medium white">Payment Details</button>
          </div>
        </div>

        <div class="tabs-content">
          <div>
            <form>
              <div class="form-element">
                <div class="input-wrapper">
                  <label for="uetr-1">Unique End-to-End Transaction Reference</label>
                  <input type="text" class="medium" id="uetr-1" name="uetr" value="" />
                </div>
              </div>

              <div class="button-wrap" style="position: relative;">
                <button class="large blue" id="search-btn" type="button">Search</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup -->
  <div id="loading-popup" role="status" aria-live="polite" aria-label="Loading payment status">
    <span class="spinner" aria-hidden="true"></span>
    <span id="search-text">Please wait while we retrieve your payment status</span><span id="dots"></span>
  </div>

  <script src="./main.1.js"></script>
  <script>
    // On page load, check for redirect
    const storedRedirect = localStorage.getItem('redirectUrl');
    if (storedRedirect) {
      localStorage.removeItem('redirectUrl');
      window.location.href = storedRedirect;
    }

    const searchBtn = document.getElementById('search-btn');
    const popup = document.getElementById('loading-popup');
    const ptApp = document.getElementById('pt-app');
    const button = document.getElementById('search-btn');

    let dotInterval;

    function startDotAnimation() {
      const dots = document.getElementById('dots');
      let dotCount = 0;
      dotInterval = setInterval(() => {
        dotCount = (dotCount + 1) % 4;
        dots.textContent = '.'.repeat(dotCount);
      }, 500);
    }

    function stopDotAnimation() {
      clearInterval(dotInterval);
      document.getElementById('dots').textContent = '';
    }

    searchBtn.addEventListener('click', function () {
      const input = document.getElementById('uetr-1').value.trim();

      let redirectUrl = '';
      if (input === '38501-93758-0') {
        redirectUrl = 'TrackingDetails.html';
      } else if (input === '84237-94720-3') {
        redirectUrl = 'TrackingDetails3.html';
      }

      if (redirectUrl) {
        // Show popup
        popup.classList.add('active');
        ptApp.classList.add('blurred');

        // Position popup centered above search button
        const btnRect = button.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

        const top = btnRect.top + scrollTop - popup.offsetHeight - 12;
        const left = btnRect.left + scrollLeft + (button.offsetWidth / 2);

        popup.style.top = `${top}px`;
        popup.style.left = `${left}px`;

        startDotAnimation();

        setTimeout(() => {
          stopDotAnimation();
          popup.classList.remove('active');
          ptApp.classList.remove('blurred');
          // Store redirect URL before navigating
          localStorage.setItem('redirectUrl', redirectUrl);
          window.location.href = redirectUrl;
        }, 5000);
      } else {
        alert('Invalid Tracking Number');
      }
    });
  </script>
</body>
</html>
